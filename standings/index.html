<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Бинго</title>
    <link rel="icon" href="../src/logo.png" type="image/png">
    <link rel="stylesheet" href="../main_style.css">
</head>
<body>
    <header>
        <table class="header">
            <tr>
                <th class="a_logo">
                    <a href="https://t.me/ne_malo">
                        <img src="../src/logo.png" class="logo">
                    </a>
                </th>
                <th class="a_logo">
                    <h1 class="single-line-header">Бинго</h1>
                </th>
                <th class="logo_empty"></th>
            </tr>
        </table>
    </header>
    <nav>
        <ul>
            <li><button onclick="window.location.href='https://fynjybath.space/bingo-lksh/';">Главная</li>
            <li><button onclick="window.location.href='https://fynjybath.space/bingo-lksh/standings';">Положение</li>
        </ul>
    </nav>

    <div id="standings"></div>

    <script defer>
        window.addEventListener('DOMContentLoaded', function () {
            const Http = new XMLHttpRequest();
            const url='https://fynjybath.space:3000/get_table';
            Http.open("GET", url);
            Http.send();

            Http.onload = function() {
                console.log(Http.responseText);
                const json = JSON.parse(Http.responseText);
                console.log(json);

                const matrix = json['problems'];
                let score = new Map();
                let penalty = new Map();

                for (let team_name in json['solved']) {
                    score.set(team_name, 0);
                    penalty.set(team_name, 0);
                }

                for (let team_name in json['solved']) {
                    console.log(team_name);
                    for (let i = 0; i < matrix.length; i++) {
                        let flag = true
                        let sum = 0
                        for (let j = 0; j < matrix[i].length; j++) {
                            if (json['solved'][team_name][i * matrix[0].length + j] == -1) {
                                flag = false;
                            } else {
                                sum = Math.max(json['solved'][team_name][i * matrix[0].length + j], sum);
                            }
                        }
                        if (flag) {
                            score.set(team_name, score.get(team_name) + 1);
                            penalty.set(team_name, penalty.get(team_name) + sum);
                        }
                    }
                }
                for (let team_name in json['solved']) {
                    console.log(team_name);
                    for (let j = 0; j < matrix[0].length; j++) {
                        let flag = true
                        let sum = 0
                        for (let i = 0; i < matrix.length; i++) {
                            if (json['solved'][team_name][i * matrix[0].length + j] == -1) {
                                flag = false;
                            } else {
                                sum = Math.max(json['solved'][team_name][i * matrix[0].length + j], sum);
                            }
                        }
                        if (flag) {
                            score.set(team_name, score.get(team_name) + 1);
                            penalty.set(team_name, penalty.get(team_name) + sum);
                        }
                    }
                }
                for (let team_name in json['solved']) {
                    console.log(team_name);
                    let flag = true
                    let sum = 0
                    for (let i = 0; i < matrix.length; i++) {
                        if (json['solved'][team_name][i * matrix[0].length + i] == -1) {
                            flag = false;
                        } else {
                            sum = Math.max(json['solved'][team_name][i * matrix[0].length + i], sum);
                        }
                    }
                    if (flag) {
                        score.set(team_name, score.get(team_name) + 1);
                        penalty.set(team_name, penalty.get(team_name) + sum);
                    }
                }
                for (let team_name in json['solved']) {
                    let flag = true
                    let sum = 0
                    for (let i = 0; i < matrix.length; i++) {
                        if (json['solved'][team_name][i * matrix[0].length + (matrix.length - i - 1)] == -1) {
                            flag = false;
                        } else {
                            sum = Math.max(json['solved'][team_name][i * matrix[0].length + (matrix.length - i - 1)], sum);
                        }
                    }
                    if (flag) {
                        score.set(team_name, score.get(team_name) + 1);
                        penalty.set(team_name, penalty.get(team_name) + sum);
                    }
                }

                let arr = [];
                for (let team_name in json['solved']) {
                    arr.push([-score.get(team_name), penalty.get(team_name), team_name]);
                }
                arr.sort();

                console.log(arr);

                const tbs = document.createElement('table');
                tbs.className = 'table-standings';
                
                const tableRow = document.createElement('tr');

                {
                    const tableCell = document.createElement('td');
                    const a = document.createElement('a');
                    a.className = 'a-standings';
                    a.textContent = 'N';
                    tableCell.appendChild(a);
                    tableRow.appendChild(tableCell);
                }

                {
                    const tableCell = document.createElement('td');
                    const a = document.createElement('a');
                    a.className = 'a-standings';
                    a.textContent = 'Команда';
                    tableCell.appendChild(a);
                    tableRow.appendChild(tableCell);
                }

                {
                    const tableCell = document.createElement('td');
                    const a = document.createElement('a');
                    a.className = 'a-standings';
                    a.textContent = 'Кол-во очков';
                    tableCell.appendChild(a);
                    tableRow.appendChild(tableCell);
                }

                {
                    const tableCell = document.createElement('td');
                    const a = document.createElement('a');
                    a.className = 'a-standings';
                    a.textContent = 'Штраф';
                    tableCell.appendChild(a);
                    tableRow.appendChild(tableCell);
                }

                tbs.appendChild(tableRow);

                document.getElementById('standings').appendChild(tbs);
            };
        });
    </script>
    
    <footer class="copyright">
        <hr>
        <p>&copy; 2024 All rights reserved.</p>
    </footer>
</body>
</html>
